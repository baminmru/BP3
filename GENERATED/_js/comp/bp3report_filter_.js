Ext.require(["Ext.form.*"]);function DefineInterface_bp3report_filter_(i,j){var h=Ext.create("Ext.grid.feature.Grouping",{groupByText:"Группировать по этому полю",showGroupsText:"Показать группировку"});var f;function c(q){if(q){Ext.Ajax.request({url:rootURL+"index.php/c_bp3report_filterfiel/deleteRow",method:"POST",params:{bp3report_filterfielid:q.get("bp3report_filterfielid")}});f.store.remove(q)}}function b(){if(f.parentid=="{00000000-0000-0000-0000-000000000000}"){return}var q=f.getView().getSelectionModel().getSelection()[0];if(q){if(CheckOperation("bp3report.edit")!=0){Ext.Msg.show({title:"Удалить?",msg:"Удалить строку из базы данных?",buttons:Ext.Msg.YESNO,icon:Ext.window.MessageBox.QUESTION,fn:function(r,t,s){if(r=="yes"){c(s.selectedRow)}},caller:f,selectedRow:q})}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Удаление строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}}function a(){if(f.parentid=="{00000000-0000-0000-0000-000000000000}"){return}if(CheckOperation("bp3report.edit")!=0){var q=Ext.create("EditWindow_bp3report_filterfiel");f.store.insert(0,new model_bp3report_filterfiel());record=f.store.getAt(0);record.set("parentid",f.parentid);q.getComponent(0).setActiveRecord(record,f.instanceid,f.parentid);q.show()}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Создание строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}function e(){if(f.parentid=="{00000000-0000-0000-0000-000000000000}"){return}f.store.load({params:{parentid:f.parentid}})}function d(){if(f.parentid=="{00000000-0000-0000-0000-000000000000}"){return}var r=f.getView().getSelectionModel().getSelection()[0];if(r){if(CheckOperation("bp3report.edit")!=0){var q=Ext.create("EditWindow_bp3report_filterfiel");q.getComponent(0).setActiveRecord(r,f.instanceid,f.parentid);q.show()}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Изменение строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}}f=new Ext.grid.Panel({itemId:"grd_bp3report_filterfiel",minHeight:200,maxHeight:1200,iconCls:"icon-grid",frame:true,parentid:"{00000000-0000-0000-0000-000000000000}",title:"Поле фильтра",scroll:"both",stateful:stateFulSystem,stateId:"bp3report_filterfiel",store:{model:"model_bp3report_filterfiel",autoLoad:false,autoSync:false,proxy:{type:"ajax",url:rootURL+"index.php/c_bp3report_filterfiel/getRows",reader:{type:"json",root:"data",successProperty:"success",messageProperty:"msg"},listeners:{exception:function(r,s,q){}}}},features:[h],dockedItems:[{xtype:"toolbar",items:[{iconCls:"icon-application_form_add",text:"Создать",scope:this,handler:a},{iconCls:"icon-application_form_edit",text:"Изменить",scope:this,disabled:true,itemId:"edit",handler:d},{iconCls:"icon-application_form_delete",text:"Удалить",disabled:true,itemId:"delete",scope:this,handler:b},{iconCls:"icon-table_refresh",text:"Обновить",itemId:"bRefresh",scope:this,handler:e}]}],columns:[{text:"Раздел, куда ссылаемся",width:200,dataIndex:"reftopart_grid",sortable:true},{text:"Тип ссылки",width:80,dataIndex:"reftype_grid",sortable:true},{text:"Массив значений",width:80,dataIndex:"valuearray_grid",sortable:true},{text:"Последовательность",width:60,dataIndex:"sequence",sortable:true},{text:"Заголовок",width:200,dataIndex:"caption",sortable:true},{text:"Название",width:200,dataIndex:"name",sortable:true},{text:"Тип поля",width:200,dataIndex:"fieldtype_grid",sortable:true},{text:"Размер",width:60,dataIndex:"fieldsize",sortable:true}],listeners:{itemdblclick:function(){d()},itemclick:function(r,q){f.down("#delete").setDisabled(false);f.down("#edit").setDisabled(false)},select:function(t,s,r,q){f.down("#delete").setDisabled(false);f.down("#edit").setDisabled(false)},selectionchange:function(r,q){f.down("#delete").setDisabled(q.length===0);f.down("#edit").setDisabled(q.length===0)}}});var g=Ext.create("Ext.grid.feature.Grouping",{groupByText:"Группировать по этому полю",showGroupsText:"Показать группировку"});var p;function m(q){if(q){Ext.Ajax.request({url:rootURL+"index.php/c_bp3report_filter/deleteRow",method:"POST",params:{bp3report_filterid:q.get("bp3report_filterid")}});p.store.remove(q)}}function l(){var q=p.getView().getSelectionModel().getSelection()[0];if(q){if(CheckOperation("bp3report.edit")!=0){Ext.Msg.show({title:"Удалить?",msg:"Удалить строку из базы данных?",buttons:Ext.Msg.YESNO,icon:Ext.window.MessageBox.QUESTION,fn:function(r,t,s){if(r=="yes"){m(s.selectedRow)}},caller:this,selectedRow:q})}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Удаление строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}}function k(){if(CheckOperation("bp3report.edit")!=0){var q=Ext.create("EditWindow_bp3report_filter");p.store.insert(0,new model_bp3report_filter());record=p.store.getAt(0);record.set("instanceid",p.instanceid);q.getComponent(0).setActiveRecord(record,p.instanceid);q.show()}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Создание строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}function o(){p.store.load({params:{instanceid:p.instanceid}})}function n(){var r=p.getView().getSelectionModel().getSelection()[0];if(r){if(CheckOperation("bp3report.edit")!=0){var q=Ext.create("EditWindow_bp3report_filter");q.getComponent(0).setActiveRecord(r,r.get("instanceid"));q.show()}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Изменение строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}}p=new Ext.grid.Panel({itemId:i,store:j,frame:true,instanceid:"",scroll:"both",autoScroll:true,width:600,features:[g],dockedItems:[{xtype:"toolbar",items:[{iconCls:"icon-application_form_add",text:"Создать",scope:this,handler:k},{iconCls:"icon-application_form_edit",text:"Изменить",scope:this,disabled:true,itemId:"edit",handler:n},{iconCls:"icon-application_form_delete",text:"Удалить",disabled:true,itemId:"delete",scope:this,handler:l},{iconCls:"icon-table_refresh",text:"Обновить",itemId:"bRefresh",scope:this,handler:o}]}],columns:[{text:"Название",width:200,dataIndex:"name",sortable:true},{text:"Последовательность",width:60,dataIndex:"sequence",sortable:true},{text:"Можно отключать",width:60,dataIndex:"allowignore_grid",sortable:true},{text:"Заголовок",width:200,dataIndex:"caption",sortable:true}],bbar:f,listeners:{resize:function(u,v,r,t,s,q){f.setHeight(r*0.5)},render:function(q){q.store.on("load",function(t,s,r){if(t.count()>0){q.getSelectionModel().select(0)}})},itemdblclick:function(){n()},itemclick:function(r,q){p.down("#delete").setDisabled(false);p.down("#edit").setDisabled(false);f.instanceid=p.instanceid;f.parentid=q.get("bp3report_filterid");f.store.load({params:{parentid:q.get("bp3report_filterid")}})},selectionchange:function(s,r){p.down("#delete").setDisabled(r.length===0);p.down("#edit").setDisabled(r.length===0);var q=r[0];if(q){p.down("#grd_bp3report_filterfiel").instanceid=p.instanceid;p.down("#grd_bp3report_filterfiel").parentid=q.get("bp3report_filterid");p.down("#grd_bp3report_filterfiel").store.load({params:{parentid:q.get("bp3report_filterid")}})}}}});return p}function DefineForms_bp3report_filter_(){Ext.define("Form_bp3report_filter",{extend:"Ext.form.Panel",alias:"widget.f_bp3report_filter",initComponent:function(){this.addEvents("create");Ext.apply(this,{activeRecord:null,defaultType:"textfield",x:0,fieldDefaults:{labelAlign:"top"},items:[{xtype:"panel",closable:false,title:"",preventHeader:true,id:"bp3report_filter-0",layout:"absolute",border:false,items:[{minWidth:740,width:740,maxWidth:740,x:5,y:0,xtype:"textfield",value:"",name:"name",itemId:"name",fieldLabel:"Название",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120},{minWidth:740,width:740,maxWidth:740,x:5,y:46,xtype:"numberfield",value:"0",name:"sequence",itemId:"sequence",fieldLabel:"Последовательность",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120},{minWidth:740,width:740,maxWidth:740,x:5,y:92,xtype:"combobox",editable:false,store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"allowignore_grid",itemId:"allowignore_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("allowignore",c[0].get("value"))}},fieldLabel:"Можно отключать",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120},{minWidth:740,width:740,maxWidth:740,x:5,y:138,xtype:"textfield",value:"",name:"caption",itemId:"caption",fieldLabel:"Заголовок",allowBlank:true,labelWidth:120}],width:770,height:214}],instanceid:"",dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",items:["->",{iconCls:"icon-accept",itemId:"save",text:"Сохранить",disabled:true,scope:this,handler:this.onSave},{iconCls:"icon-cancel",text:"Закрыть",scope:this,handler:this.onReset}]}]});this.callParent()},setActiveRecord:function(b,a){this.activeRecord=b;this.instanceid=a;if(b){this.down("#save").enable();this.getForm().loadRecord(b)}else{this.down("#save").disable();this.getForm().reset()}},onSave:function(){var a=this.activeRecord,b=this.getForm();if(!a){return}if(b.isValid()){b.updateRecord(a);StatusDB("Сохранение данных");Ext.Ajax.request({url:rootURL+"index.php/c_bp3report_filter/setRow",method:"POST",params:{instanceid:this.instanceid,bp3report_filterid:a.get("bp3report_filterid"),name:a.get("name"),sequence:a.get("sequence"),allowignore:a.get("allowignore"),caption:a.get("caption")},success:function(d){var e=d.responseText;var c=Ext.decode(e);if(c.success==false){Ext.MessageBox.show({title:"Ошибка",msg:c.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});StatusErr("Ошибка. "+c.msg)}else{if(a.get("bp3report_filterid")==""){a.set("bp3report_filterid",c.data.bp3report_filterid)}StatusReady("Изменения сохранены");b.owner.ownerCt.close()}}})}else{Ext.MessageBox.show({title:"Ошибка",msg:"Не все обязательные поля заполнены!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},onReset:function(){if(this.activeRecord.get("bp3report_filterid")==""){this.activeRecord.store.reload()}this.setActiveRecord(null,null);this.ownerCt.close()}});Ext.define("EditWindow_bp3report_filter",{extend:"Ext.window.Window",maxHeight:319,maxWidth:900,autoScroll:true,minWidth:750,width:800,minHeight:289,height:289,constrainHeader:true,layout:"absolute",autoShow:true,modal:true,closable:false,closeAction:"destroy",iconCls:"icon-application_form",title:"Группа полей фильтра",items:[{xtype:"f_bp3report_filter"}]});Ext.define("Form_bp3report_filterfiel",{extend:"Ext.form.Panel",alias:"widget.f_bp3report_filterfiel",initComponent:function(){this.addEvents("create");Ext.apply(this,{activeRecord:null,defaultType:"textfield",x:0,fieldDefaults:{labelAlign:"top"},items:[{xtype:"panel",closable:false,title:"",preventHeader:true,id:"bp3report_filterfiel-0",layout:"absolute",border:false,items:[{minWidth:740,width:740,maxWidth:740,x:5,y:0,xtype:"combobox",trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue();this.up("form").activeRecord.set("reftopart",null)},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{if(this.store.count(false)==0){this.store.load()}this.expand()}},editable:false,listeners:{select:function(a,c,b){a.up("form").activeRecord.set("reftopart",c[0].get("id"))}},store:cmbstore_bp3doc_store,valueField:"brief",displayField:"brief",typeAhead:true,emptyText:"",name:"reftopart_grid",itemId:"reftopart_grid",fieldLabel:"Раздел, куда ссылаемся",allowBlank:true,labelWidth:120},{minWidth:740,width:740,maxWidth:740,x:5,y:46,xtype:"combobox",editable:false,trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue()},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{this.expand()}},store:enum_ReferenceType,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"reftype_grid",itemId:"reftype_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("reftype",c[0].get("value"))}},fieldLabel:"Тип ссылки",allowBlank:true,labelWidth:120},{minWidth:740,width:740,maxWidth:740,x:5,y:92,xtype:"combobox",editable:false,trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue()},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{this.expand()}},store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"valuearray_grid",itemId:"valuearray_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("valuearray",c[0].get("value"))}},fieldLabel:"Массив значений",allowBlank:true,labelWidth:120},{minWidth:740,width:740,maxWidth:740,x:5,y:138,xtype:"numberfield",value:"0",name:"sequence",itemId:"sequence",fieldLabel:"Последовательность",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120},{minWidth:740,width:740,maxWidth:740,x:5,y:184,xtype:"textfield",value:"",name:"caption",itemId:"caption",fieldLabel:"Заголовок",allowBlank:true,labelWidth:120},{minWidth:740,width:740,maxWidth:740,x:5,y:230,xtype:"textfield",value:"",name:"name",itemId:"name",fieldLabel:"Название",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120},{minWidth:740,width:740,maxWidth:740,x:5,y:276,xtype:"combobox",trigger1Cls:"x-form-select-trigger",hideTrigger1:false,onTrigger1Click:function(){if(this.isExpanded){this.collapse()}else{if(this.store.count(false)==0){this.store.load()}this.expand()}},editable:false,listeners:{select:function(a,c,b){a.up("form").activeRecord.set("fieldtype",c[0].get("id"))}},store:cmbstore_bp3ft_def,valueField:"brief",displayField:"brief",typeAhead:true,emptyText:"",name:"fieldtype_grid",itemId:"fieldtype_grid",fieldLabel:"Тип поля",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120},{minWidth:740,width:740,maxWidth:740,x:5,y:322,xtype:"numberfield",value:"0",name:"fieldsize",itemId:"fieldsize",fieldLabel:"Размер",allowBlank:true,labelWidth:120}],width:770,height:398}],instanceid:"",dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",items:["->",{iconCls:"icon-accept",itemId:"save",text:"Сохранить",disabled:true,scope:this,handler:this.onSave},{iconCls:"icon-cancel",text:"Закрыть",scope:this,handler:this.onReset}]}]});this.callParent()},setActiveRecord:function(c,a,b){this.activeRecord=c;this.instanceid=a;this.parentid=b;if(c){this.down("#save").enable();this.getForm().loadRecord(c)}else{this.down("#save").disable();this.getForm().reset()}},onSave:function(){var a=this.activeRecord,b=this.getForm();if(!a){return}if(b.isValid()){b.updateRecord(a);StatusDB("Сохранение данных");Ext.Ajax.request({url:rootURL+"index.php/c_bp3report_filterfiel/setRow",method:"POST",params:{instanceid:this.instanceid,parentid:this.parentid,bp3report_filterfielid:a.get("bp3report_filterfielid"),reftopart:a.get("reftopart"),reftype:a.get("reftype"),valuearray:a.get("valuearray"),sequence:a.get("sequence"),caption:a.get("caption"),name:a.get("name"),fieldtype:a.get("fieldtype"),fieldsize:a.get("fieldsize")},success:function(d){var e=d.responseText;var c=Ext.decode(e);if(c.success==false){Ext.MessageBox.show({title:"Ошибка",msg:c.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});StatusErr("Ошибка. "+c.msg)}else{if(a.get("bp3report_filterfielid")==""){a.set("bp3report_filterfielid",c.data.bp3report_filterfielid)}StatusReady("Изменения сохранены");b.owner.ownerCt.close()}}})}else{Ext.MessageBox.show({title:"Ошибка",msg:"Не все обязательные поля заполнены!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},onReset:function(){if(this.activeRecord.get("bp3report_filterfielid")==""){this.activeRecord.store.reload()}this.setActiveRecord(null,null);this.ownerCt.close()}});Ext.define("EditWindow_bp3report_filterfiel",{extend:"Ext.window.Window",maxHeight:503,maxWidth:900,autoScroll:true,minWidth:750,width:800,minHeight:473,height:473,constrainHeader:true,layout:"absolute",autoShow:true,modal:true,closable:false,closeAction:"destroy",iconCls:"icon-application_form",title:"Поле фильтра",items:[{xtype:"f_bp3report_filterfiel"}]})};
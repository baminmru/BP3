Ext.require(["Ext.form.*"]);function DefineInterface_bp3report_def_(a,b,j){var g;var h=false;var i=false;function d(m,l){var k=g.activeRecord,n=g.getForm();if(!k){return}if(n.isValid()){n.updateRecord(k);StatusDB("Сохранение данных");Ext.Ajax.request({url:rootURL+"index.php/c_bp3report_def/setRow",method:"POST",params:{instanceid:g.instanceid,bp3report_defid:k.get("bp3report_defid"),caption:k.get("caption"),reporttype:k.get("reporttype"),thecomment:k.get("thecomment"),reportfile:k.get("reportfile"),name:k.get("name"),reportview:k.get("reportview")},success:function(p){var q=p.responseText;var o=Ext.decode(q);if(o.success==false){Ext.MessageBox.show({title:"Ошибка",msg:o.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});StatusErr("Ошибка. "+o.msg);h=false}else{if(k.get("bp3report_defid")==""){k.set("bp3report_defid",o.data.bp3report_defid)}StatusReady("Изменения сохранены");h=true;if(j){Ext.Ajax.request({url:rootURL+'index.php/c_v_autobp3report_def/getRows?&filter=[{"property":"bp3report_defid","value":"'+k.get("bp3report_defid")+'"}]',method:"GET",success:function(s){var r=Ext.decode(s.responseText);j.set(r.rows[0]);j.commit()}})}if(m){if(typeof(l)=="function"){l()}g.up("window").close()}}}})}else{Ext.MessageBox.show({title:"Ошибка",msg:"Не все обязательные поля заполнены!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}function e(k){d(false,k)}function f(k){d(true,k)}function c(){g.setActiveRecord(null,null)}g=new Ext.form.Panel({itemId:a+"",autoScroll:true,border:0,bodyPadding:5,activeRecord:null,selection:j,defaultType:"textfield",doSave:f,canClose:function(){if(i){if(!g.getForm().isValid()){return true}return true}else{if(!g.getForm().isValid()){return false}if(h){return true}return false}},fieldDefaults:{labelAlign:"right",labelWidth:110},items:[{xtype:"fieldset",anchor:"100%",id:"bp3report_def-0",x:0,border:1,layout:"absolute",items:[{minWidth:365,width:365,maxWidth:365,x:5,y:5,labelWidth:140,xtype:"textfield",value:"",name:"caption",itemId:"caption",fieldLabel:"Заголовок",allowBlank:true},{minWidth:365,width:365,maxWidth:365,x:375,y:5,labelWidth:140,xtype:"combobox",editable:false,store:enum_ReportType,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"reporttype_grid",itemId:"reporttype_grid",listeners:{select:function(k,m,l){k.up("form").activeRecord.set("reporttype",m[0].get("value"))}},fieldLabel:"Тип отчета",labelClsExtra:"x-item-mandatory",allowBlank:false},{minWidth:720,xtype:"textarea",x:5,y:35,height:80,labelWidth:140,xtype:"textarea",value:"",name:"thecomment",itemId:"thecomment",fieldLabel:"Описание",allowBlank:true},{minWidth:365,width:365,maxWidth:365,x:5,y:125,labelWidth:140,xtype:"filefield",name:"reportfile_fu",itemId:"reportfile_fu",buttonText:"Выбрать",buttonConfig:{iconCls:"icon-iu_upload"},fieldLabel:"Файл отчета",allowBlank:true},{minWidth:365,width:365,maxWidth:365,x:375,y:125,labelWidth:140,xtype:"textfield",value:"",name:"name",itemId:"name",fieldLabel:"Название",labelClsExtra:"x-item-mandatory",allowBlank:false},{minWidth:365,width:365,maxWidth:365,x:5,y:155,labelWidth:140,xtype:"combobox",trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue();this.up("form").activeRecord.set("reportview",null)},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{if(this.store.count(false)==0){this.store.load()}this.expand()}},editable:false,listeners:{select:function(k,m,l){k.up("form").activeRecord.set("reportview",m[0].get("id"))}},store:cmbstore_bp3qry_def,valueField:"brief",displayField:"brief",typeAhead:true,emptyText:"",name:"reportview_grid",itemId:"reportview_grid",fieldLabel:"Базовый запрос",allowBlank:true}],height:205}],instanceid:"",setActiveRecord:function(l,k){g.activeRecord=l;g.instanceid=k;if(l){g.getForm().loadRecord(l);i=g.getForm().isValid()}else{g.getForm().reset()}}});return g}function DefineForms_bp3report_def_(){Ext.define("Form_bp3report_def",{extend:"Ext.form.Panel",alias:"widget.f_bp3report_def",initComponent:function(){this.addEvents("create");Ext.apply(this,{activeRecord:null,defaultType:"textfield",x:0,fieldDefaults:{labelAlign:"top"},items:[{xtype:"panel",closable:false,title:"",preventHeader:true,id:"bp3report_def-0",layout:"absolute",border:false,items:[{minWidth:220,width:220,maxWidth:220,x:5,y:0,xtype:"textfield",value:"",name:"caption",itemId:"caption",fieldLabel:"Заголовок",allowBlank:true,labelWidth:120},{minWidth:220,width:220,maxWidth:220,x:255,y:0,xtype:"combobox",editable:false,store:enum_ReportType,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"reporttype_grid",itemId:"reporttype_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("reporttype",c[0].get("value"))}},fieldLabel:"Тип отчета",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120},{minWidth:740,width:740,xtype:"textarea",x:5,y:46,height:80,xtype:"textarea",value:"",name:"thecomment",itemId:"thecomment",fieldLabel:"Описание",allowBlank:true,labelWidth:120},{minWidth:220,width:220,maxWidth:220,x:5,y:136,xtype:"filefield",name:"reportfile_fu",itemId:"reportfile_fu",buttonText:"Выбрать",buttonConfig:{iconCls:"icon-iu_upload"},fieldLabel:"Файл отчета",allowBlank:true,labelWidth:120},{xtype:"hidden",name:"reportfile",itemId:"reportfile",},{xtype:"hidden",name:"reportfile_ext",itemId:"reportfile_ext",},{minWidth:220,width:220,maxWidth:220,x:255,y:136,xtype:"textfield",value:"",name:"name",itemId:"name",fieldLabel:"Название",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120},{minWidth:220,width:220,maxWidth:220,x:505,y:136,xtype:"combobox",trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue();this.up("form").activeRecord.set("reportview",null)},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{if(this.store.count(false)==0){this.store.load()}this.expand()}},editable:false,listeners:{select:function(a,c,b){a.up("form").activeRecord.set("reportview",c[0].get("id"))}},store:cmbstore_bp3qry_def,valueField:"brief",displayField:"brief",typeAhead:true,emptyText:"",name:"reportview_grid",itemId:"reportview_grid",fieldLabel:"Базовый запрос",allowBlank:true,labelWidth:120}],width:770,height:212}],instanceid:"",dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",items:["->",{iconCls:"icon-accept",itemId:"save",text:"Сохранить",disabled:true,scope:this,handler:this.onSave}]}]});this.callParent()},setActiveRecord:function(b,a){this.activeRecord=b;this.instanceid=a;if(b){this.down("#save").enable();this.getForm().loadRecord(b)}else{this.down("#save").disable();this.getForm().reset()}},onSave:function(){var a=this.activeRecord,b=this.getForm();if(!a){return}if(b.isValid()){b.updateRecord(a);StatusDB("Сохранение данных");Ext.Ajax.request({url:rootURL+"index.php/c_bp3report_def/setRow",method:"POST",params:{instanceid:this.instanceid,bp3report_defid:a.get("bp3report_defid"),caption:a.get("caption"),reporttype:a.get("reporttype"),thecomment:a.get("thecomment"),reportfile:a.get("reportfile"),name:a.get("name"),reportview:a.get("reportview")},success:function(d){var e=d.responseText;var c=Ext.decode(e);if(c.success==false){Ext.MessageBox.show({title:"Ошибка",msg:c.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});StatusErr("Ошибка. "+c.msg)}else{if(a.get("bp3report_defid")==""){a.set("bp3report_defid",c.data.bp3report_defid)}StatusReady("Изменения сохранены")}}})}else{Ext.MessageBox.show({title:"Ошибка",msg:"Не все обязательные поля заполнены!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},onReset:function(){if(this.activeRecord.get("bp3report_defid")==""){this.activeRecord.store.reload()}this.setActiveRecord(null,null);this.ownerCt.close()}});Ext.define("EditWindow_bp3report_def",{extend:"Ext.window.Window",maxHeight:317,maxWidth:900,autoScroll:true,minWidth:750,width:800,minHeight:287,height:287,constrainHeader:true,layout:"absolute",autoShow:true,modal:true,closable:false,closeAction:"destroy",iconCls:"icon-application_form",title:"Описание",items:[{xtype:"f_bp3report_def"}]})};
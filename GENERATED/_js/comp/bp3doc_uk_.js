Ext.require(["Ext.form.*"]);function DefineInterface_bp3doc_uk_(i,j){var h=Ext.create("Ext.grid.feature.Grouping",{groupByText:"Группировать по этому полю",showGroupsText:"Показать группировку"});var f;function c(q){if(q){Ext.Ajax.request({url:rootURL+"index.php/c_bp3doc_ukfld/deleteRow",method:"POST",params:{bp3doc_ukfldid:q.get("bp3doc_ukfldid")}});f.store.remove(q)}}function b(){if(f.parentid=="{00000000-0000-0000-0000-000000000000}"){return}var q=f.getView().getSelectionModel().getSelection()[0];if(q){if(CheckOperation("bp3doc.edit")!=0){Ext.Msg.show({title:"Удалить?",msg:"Удалить строку из базы данных?",buttons:Ext.Msg.YESNO,icon:Ext.window.MessageBox.QUESTION,fn:function(r,t,s){if(r=="yes"){c(s.selectedRow)}},caller:f,selectedRow:q})}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Удаление строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}}function a(){if(f.parentid=="{00000000-0000-0000-0000-000000000000}"){return}if(CheckOperation("bp3doc.edit")!=0){var q=Ext.create("EditWindow_bp3doc_ukfld");f.store.insert(0,new model_bp3doc_ukfld());record=f.store.getAt(0);record.set("parentid",f.parentid);q.getComponent(0).setActiveRecord(record,f.instanceid,f.parentid);q.show()}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Создание строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}function e(){if(f.parentid=="{00000000-0000-0000-0000-000000000000}"){return}f.store.load({params:{parentid:f.parentid}})}function d(){if(f.parentid=="{00000000-0000-0000-0000-000000000000}"){return}var r=f.getView().getSelectionModel().getSelection()[0];if(r){if(CheckOperation("bp3doc.edit")!=0){var q=Ext.create("EditWindow_bp3doc_ukfld");q.getComponent(0).setActiveRecord(r,f.instanceid,f.parentid);q.show()}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Изменение строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}}f=new Ext.grid.Panel({itemId:"grd_bp3doc_ukfld",minHeight:200,maxHeight:1200,iconCls:"icon-grid",frame:true,parentid:"{00000000-0000-0000-0000-000000000000}",title:"Поля ограничения",scroll:"both",stateful:stateFulSystem,stateId:"bp3doc_ukfld",store:{model:"model_bp3doc_ukfld",autoLoad:false,autoSync:false,proxy:{type:"ajax",url:rootURL+"index.php/c_bp3doc_ukfld/getRows",reader:{type:"json",root:"data",successProperty:"success",messageProperty:"msg"},listeners:{exception:function(r,s,q){}}}},features:[h],dockedItems:[{xtype:"toolbar",items:[{iconCls:"icon-application_form_add",text:"Создать",scope:this,handler:a},{iconCls:"icon-application_form_edit",text:"Изменить",scope:this,disabled:true,itemId:"edit",handler:d},{iconCls:"icon-application_form_delete",text:"Удалить",disabled:true,itemId:"delete",scope:this,handler:b},{iconCls:"icon-table_refresh",text:"Обновить",itemId:"bRefresh",scope:this,handler:e}]}],columns:[{text:"Поле",width:200,dataIndex:"thefield_grid",sortable:true}],listeners:{itemdblclick:function(){d()},itemclick:function(r,q){f.down("#delete").setDisabled(false);f.down("#edit").setDisabled(false)},select:function(t,s,r,q){f.down("#delete").setDisabled(false);f.down("#edit").setDisabled(false)},selectionchange:function(r,q){f.down("#delete").setDisabled(q.length===0);f.down("#edit").setDisabled(q.length===0)}}});var g=Ext.create("Ext.grid.feature.Grouping",{groupByText:"Группировать по этому полю",showGroupsText:"Показать группировку"});var p;function m(q){if(q){Ext.Ajax.request({url:rootURL+"index.php/c_bp3doc_uk/deleteRow",method:"POST",params:{bp3doc_ukid:q.get("bp3doc_ukid")}});p.store.remove(q)}}function l(){var q=p.getView().getSelectionModel().getSelection()[0];if(q){if(CheckOperation("bp3doc.edit")!=0){Ext.Msg.show({title:"Удалить?",msg:"Удалить строку из базы данных?",buttons:Ext.Msg.YESNO,icon:Ext.window.MessageBox.QUESTION,fn:function(r,t,s){if(r=="yes"){m(s.selectedRow)}},caller:this,selectedRow:q})}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Удаление строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}}function k(){if(CheckOperation("bp3doc.edit")!=0){var q=Ext.create("EditWindow_bp3doc_uk");p.store.insert(0,new model_bp3doc_uk());record=p.store.getAt(0);record.set("instanceid",p.instanceid);q.getComponent(0).setActiveRecord(record,p.instanceid);q.show()}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Создание строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}function o(){p.store.load({params:{instanceid:p.instanceid}})}function n(){var r=p.getView().getSelectionModel().getSelection()[0];if(r){if(CheckOperation("bp3doc.edit")!=0){var q=Ext.create("EditWindow_bp3doc_uk");q.getComponent(0).setActiveRecord(r,r.get("instanceid"));q.show()}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Изменение строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}}p=new Ext.grid.Panel({itemId:i,store:j,frame:true,instanceid:"",scroll:"both",autoScroll:true,width:600,features:[g],dockedItems:[{xtype:"toolbar",items:[{iconCls:"icon-application_form_add",text:"Создать",scope:this,handler:k},{iconCls:"icon-application_form_edit",text:"Изменить",scope:this,disabled:true,itemId:"edit",handler:n},{iconCls:"icon-application_form_delete",text:"Удалить",disabled:true,itemId:"delete",scope:this,handler:l},{iconCls:"icon-table_refresh",text:"Обновить",itemId:"bRefresh",scope:this,handler:o}]}],columns:[{text:"Раздел",width:200,dataIndex:"ukstore_grid",sortable:true},{text:"Описание",width:200,dataIndex:"thecomment",sortable:true},{text:"Название",width:200,dataIndex:"name",sortable:true},{text:"По родителю",width:60,dataIndex:"perparent_grid",sortable:true}],bbar:f,listeners:{resize:function(u,v,r,t,s,q){f.setHeight(r*0.5)},render:function(q){q.store.on("load",function(t,s,r){if(t.count()>0){q.getSelectionModel().select(0)}})},itemdblclick:function(){n()},itemclick:function(r,q){p.down("#delete").setDisabled(false);p.down("#edit").setDisabled(false);f.instanceid=p.instanceid;f.parentid=q.get("bp3doc_ukid");f.store.load({params:{parentid:q.get("bp3doc_ukid")}})},selectionchange:function(s,r){p.down("#delete").setDisabled(r.length===0);p.down("#edit").setDisabled(r.length===0);var q=r[0];if(q){p.down("#grd_bp3doc_ukfld").instanceid=p.instanceid;p.down("#grd_bp3doc_ukfld").parentid=q.get("bp3doc_ukid");p.down("#grd_bp3doc_ukfld").store.load({params:{parentid:q.get("bp3doc_ukid")}})}}}});return p}function DefineForms_bp3doc_uk_(){Ext.define("Form_bp3doc_uk",{extend:"Ext.form.Panel",alias:"widget.f_bp3doc_uk",initComponent:function(){this.addEvents("create");Ext.apply(this,{activeRecord:null,defaultType:"textfield",x:0,fieldDefaults:{labelAlign:"top"},items:[{xtype:"panel",closable:false,title:"",preventHeader:true,id:"bp3doc_uk-0",layout:"absolute",border:false,items:[{minWidth:740,width:740,maxWidth:740,x:5,y:0,xtype:"combobox",trigger1Cls:"x-form-select-trigger",hideTrigger1:false,onTrigger1Click:function(){if(this.isExpanded){this.collapse()}else{if(this.store.count(false)==0){this.store.load()}this.expand()}},editable:false,listeners:{select:function(a,c,b){a.up("form").activeRecord.set("ukstore",c[0].get("id"))}},store:cmbstore_bp3doc_store,valueField:"brief",displayField:"brief",typeAhead:true,emptyText:"",name:"ukstore_grid",itemId:"ukstore_grid",fieldLabel:"Раздел",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120},{minWidth:740,width:740,xtype:"textarea",x:5,y:46,height:80,xtype:"textarea",value:"",name:"thecomment",itemId:"thecomment",fieldLabel:"Описание",allowBlank:true,labelWidth:120},{minWidth:740,width:740,maxWidth:740,x:5,y:136,xtype:"textfield",value:"",name:"name",itemId:"name",fieldLabel:"Название",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120},{minWidth:740,width:740,maxWidth:740,x:5,y:182,xtype:"combobox",editable:false,store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"perparent_grid",itemId:"perparent_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("perparent",c[0].get("value"))}},fieldLabel:"По родителю",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120}],width:770,height:258}],instanceid:"",dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",items:["->",{iconCls:"icon-accept",itemId:"save",text:"Сохранить",disabled:true,scope:this,handler:this.onSave},{iconCls:"icon-cancel",text:"Закрыть",scope:this,handler:this.onReset}]}]});this.callParent()},setActiveRecord:function(b,a){this.activeRecord=b;this.instanceid=a;if(b){this.down("#save").enable();this.getForm().loadRecord(b)}else{this.down("#save").disable();this.getForm().reset()}},onSave:function(){var a=this.activeRecord,b=this.getForm();if(!a){return}if(b.isValid()){b.updateRecord(a);StatusDB("Сохранение данных");Ext.Ajax.request({url:rootURL+"index.php/c_bp3doc_uk/setRow",method:"POST",params:{instanceid:this.instanceid,bp3doc_ukid:a.get("bp3doc_ukid"),ukstore:a.get("ukstore"),thecomment:a.get("thecomment"),name:a.get("name"),perparent:a.get("perparent")},success:function(d){var e=d.responseText;var c=Ext.decode(e);if(c.success==false){Ext.MessageBox.show({title:"Ошибка",msg:c.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});StatusErr("Ошибка. "+c.msg)}else{if(a.get("bp3doc_ukid")==""){a.set("bp3doc_ukid",c.data.bp3doc_ukid)}StatusReady("Изменения сохранены");b.owner.ownerCt.close()}}})}else{Ext.MessageBox.show({title:"Ошибка",msg:"Не все обязательные поля заполнены!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},onReset:function(){if(this.activeRecord.get("bp3doc_ukid")==""){this.activeRecord.store.reload()}this.setActiveRecord(null,null);this.ownerCt.close()}});Ext.define("EditWindow_bp3doc_uk",{extend:"Ext.window.Window",maxHeight:363,maxWidth:900,autoScroll:true,minWidth:750,width:800,minHeight:333,height:333,constrainHeader:true,layout:"absolute",autoShow:true,modal:true,closable:false,closeAction:"destroy",iconCls:"icon-application_form",title:"Ограничение уникальности",items:[{xtype:"f_bp3doc_uk"}]});Ext.define("Form_bp3doc_ukfld",{extend:"Ext.form.Panel",alias:"widget.f_bp3doc_ukfld",initComponent:function(){this.addEvents("create");Ext.apply(this,{activeRecord:null,defaultType:"textfield",x:0,fieldDefaults:{labelAlign:"top"},items:[{xtype:"panel",closable:false,title:"",preventHeader:true,id:"bp3doc_ukfld-0",layout:"absolute",border:false,items:[{minWidth:740,width:740,maxWidth:740,x:5,y:0,xtype:"combobox",trigger1Cls:"x-form-select-trigger",hideTrigger1:false,onTrigger1Click:function(){if(this.isExpanded){this.collapse()}else{if(this.store.count(false)==0){this.store.load()}this.expand()}},editable:false,listeners:{select:function(a,c,b){a.up("form").activeRecord.set("thefield",c[0].get("id"))}},store:cmbstore_field,valueField:"brief",displayField:"brief",typeAhead:true,emptyText:"",name:"thefield_grid",itemId:"thefield_grid",fieldLabel:"Поле",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120}],width:770,height:76}],instanceid:"",dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",items:["->",{iconCls:"icon-accept",itemId:"save",text:"Сохранить",disabled:true,scope:this,handler:this.onSave},{iconCls:"icon-cancel",text:"Закрыть",scope:this,handler:this.onReset}]}]});this.callParent()},setActiveRecord:function(c,a,b){this.activeRecord=c;this.instanceid=a;this.parentid=b;if(c){this.down("#save").enable();this.getForm().loadRecord(c)}else{this.down("#save").disable();this.getForm().reset()}},onSave:function(){var a=this.activeRecord,b=this.getForm();if(!a){return}if(b.isValid()){b.updateRecord(a);StatusDB("Сохранение данных");Ext.Ajax.request({url:rootURL+"index.php/c_bp3doc_ukfld/setRow",method:"POST",params:{instanceid:this.instanceid,parentid:this.parentid,bp3doc_ukfldid:a.get("bp3doc_ukfldid"),thefield:a.get("thefield")},success:function(d){var e=d.responseText;var c=Ext.decode(e);if(c.success==false){Ext.MessageBox.show({title:"Ошибка",msg:c.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});StatusErr("Ошибка. "+c.msg)}else{if(a.get("bp3doc_ukfldid")==""){a.set("bp3doc_ukfldid",c.data.bp3doc_ukfldid)}StatusReady("Изменения сохранены");b.owner.ownerCt.close()}}})}else{Ext.MessageBox.show({title:"Ошибка",msg:"Не все обязательные поля заполнены!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},onReset:function(){if(this.activeRecord.get("bp3doc_ukfldid")==""){this.activeRecord.store.reload()}this.setActiveRecord(null,null);this.ownerCt.close()}});Ext.define("EditWindow_bp3doc_ukfld",{extend:"Ext.window.Window",maxHeight:181,maxWidth:900,autoScroll:true,minWidth:750,width:800,minHeight:151,height:151,constrainHeader:true,layout:"absolute",autoShow:true,modal:true,closable:false,closeAction:"destroy",iconCls:"icon-application_form",title:"Поля ограничения",items:[{xtype:"f_bp3doc_ukfld"}]})};
Ext.require(["Ext.form.*"]);function DefineInterface_bp3doc_store_(h,p){var g=Ext.create("Ext.grid.feature.Grouping",{groupByText:"Группировать по этому полю",showGroupsText:"Показать группировку"});var f;function c(q){if(q){Ext.Ajax.request({url:rootURL+"index.php/c_bp3doc_field/deleteRow",method:"POST",params:{bp3doc_fieldid:q.get("bp3doc_fieldid")}});f.store.remove(q)}}function b(){if(f.parentid=="{00000000-0000-0000-0000-000000000000}"){return}var q=f.getView().getSelectionModel().getSelection()[0];if(q){if(CheckOperation("bp3doc.edit")!=0){Ext.Msg.show({title:"Удалить?",msg:"Удалить строку из базы данных?",buttons:Ext.Msg.YESNO,icon:Ext.window.MessageBox.QUESTION,fn:function(r,t,s){if(r=="yes"){c(s.selectedRow)}},caller:f,selectedRow:q})}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Удаление строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}}function a(){if(f.parentid=="{00000000-0000-0000-0000-000000000000}"){return}if(CheckOperation("bp3doc.edit")!=0){var q=Ext.create("EditWindow_bp3doc_field");f.store.insert(0,new model_bp3doc_field());record=f.store.getAt(0);record.set("parentid",f.parentid);q.getComponent(0).setActiveRecord(record,f.instanceid,f.parentid);q.show()}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Создание строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}function e(){if(f.parentid=="{00000000-0000-0000-0000-000000000000}"){return}f.store.load({params:{parentid:f.parentid}})}function d(){if(f.parentid=="{00000000-0000-0000-0000-000000000000}"){return}var r=f.getView().getSelectionModel().getSelection()[0];if(r){if(CheckOperation("bp3doc.edit")!=0){var q=Ext.create("EditWindow_bp3doc_field");q.getComponent(0).setActiveRecord(r,f.instanceid,f.parentid);q.show()}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Изменение строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}}f=new Ext.grid.Panel({itemId:"grd_bp3doc_field",minWidth:200,maxWidth:1700,iconCls:"icon-grid",frame:true,parentid:"{00000000-0000-0000-0000-000000000000}",title:"Поле",scroll:"both",stateful:stateFulSystem,stateId:"bp3doc_field",store:{model:"model_bp3doc_field",autoLoad:false,autoSync:false,proxy:{type:"ajax",url:rootURL+"index.php/c_bp3doc_field/getRows",reader:{type:"json",root:"data",successProperty:"success",messageProperty:"msg"},listeners:{exception:function(r,s,q){}}}},features:[g],dockedItems:[{xtype:"toolbar",items:[{iconCls:"icon-application_form_add",text:"Создать",scope:this,handler:a},{iconCls:"icon-application_form_edit",text:"Изменить",scope:this,disabled:true,itemId:"edit",handler:d},{iconCls:"icon-application_form_delete",text:"Удалить",disabled:true,itemId:"delete",scope:this,handler:b},{iconCls:"icon-table_refresh",text:"Обновить",itemId:"bRefresh",scope:this,handler:e}]}],columns:[{text:"№ п/п",width:60,dataIndex:"sequence",sortable:true},{text:"Имя поля",width:200,dataIndex:"name",sortable:true},{text:"Надпись",width:200,dataIndex:"caption",sortable:true},{text:"Имя вкладки",width:200,dataIndex:"tabname",sortable:true},{text:"Имя группы",width:200,dataIndex:"fieldgroupbox",sortable:true},{text:"Может быть пустым",width:80,dataIndex:"allownull_grid",sortable:true},{text:"Тип поля",width:200,dataIndex:"fieldtype_grid",sortable:true},{text:"Тип ссылки",width:80,dataIndex:"referencetype_grid",sortable:true},{text:"Размер поля",width:60,dataIndex:"datasize",sortable:true},{text:"Ссылка на раздел",width:200,dataIndex:"reftopart_grid",sortable:true},{text:"Ссылка в пределах объекта",width:80,dataIndex:"internalreference_grid",sortable:true},{text:"Описание",width:200,dataIndex:"thecomment",sortable:true},{text:"Автонумерация",width:80,dataIndex:"isautonumber_grid",sortable:true},{text:"Краткая информация",width:80,dataIndex:"isbrief_grid",sortable:true},{text:"Для отображения в таблице",width:80,dataIndex:"istabbrief_grid",sortable:true},{text:"Стиль",width:200,dataIndex:"thestyle",sortable:true},{text:"Маска",width:200,dataIndex:"themask",sortable:true},{text:"Шаблон для краткого отображения",width:200,dataIndex:"shablonbrief",sortable:true}],listeners:{itemdblclick:function(){d()},itemclick:function(r,q){f.down("#delete").setDisabled(false);f.down("#edit").setDisabled(false)},select:function(t,s,r,q){f.down("#delete").setDisabled(false);f.down("#edit").setDisabled(false)},selectionchange:function(r,q){f.down("#delete").setDisabled(q.length===0);f.down("#edit").setDisabled(q.length===0)}}});var o;function l(q){if(q){Ext.Ajax.request({url:rootURL+"index.php/c_bp3doc_store/deleteRow",method:"POST",params:{bp3doc_storeid:q.get("bp3doc_storeid")}});n()}}function k(){var q=o.getView().getSelectionModel().getSelection()[0];if(q){if(CheckOperation("bp3doc.edit")!=0){Ext.Msg.show({title:"Удалить?",msg:"Удалить строку из базы данных?",buttons:Ext.Msg.YESNO,icon:Ext.window.MessageBox.QUESTION,fn:function(r,t,s){if(r=="yes"){l(s.selectedRow)}},caller:this,selectedRow:q})}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Удаление строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}}function j(){if(CheckOperation("bp3doc.edit")!=0){var q=Ext.create("EditWindow_bp3doc_store");o.lasttreeid="{00000000-0000-0000-0000-000000000000}";record=new model_bp3doc_store();record.set("instanceid",o.instanceid);record.set("parentrowid",o.lasttreeid);o.store.getRootNode().insertChild(0,record);q.getComponent(0).setActiveRecord(o,record,o.instanceid);q.show()}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Создание строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}function i(){if(CheckOperation("bp3doc.edit")!=0){var r=o.getView().getSelectionModel().getSelection()[0];if(r){o.lasttreeid=r.get("bp3doc_storeid");record=new model_bp3doc_store();record.set("instanceid",o.instanceid);record.set("parentrowid",o.lasttreeid);o.store.getNodeById(o.lasttreeid).insertChild(0,record)}else{o.lasttreeid="{00000000-0000-0000-0000-000000000000}";record=new model_bp3doc_store();record.set("instanceid",o.instanceid);record.set("parentrowid",o.lasttreeid);o.store.getRootNode().insertChild(0,record)}var q=Ext.create("EditWindow_bp3doc_store");record.set("instanceid",o.instanceid);record.set("parentrowid",o.lasttreeid);q.getComponent(0).setActiveRecord(o,record,o.instanceid);q.show()}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Создание строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}function n(){o.store.load({params:{instanceid:o.instanceid}})}function m(){var r=o.getView().getSelectionModel().getSelection()[0];if(r){if(CheckOperation("bp3doc.edit")!=0){var q=Ext.create("EditWindow_bp3doc_store");q.getComponent(0).setActiveRecord(o,r,r.get("instanceid"));q.show()}else{Ext.MessageBox.show({title:"Контроль прав.",msg:"Изменение строк не разрешено!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING})}}}o=new Ext.tree.Panel({itemId:h,autoScroll:true,width:600,frame:true,instanceid:"{00000000-0000-0000-0000-000000000000}",lasttreeid:"{00000000-0000-0000-0000-000000000000}",rootVisible:false,store:p,dockedItems:[{xtype:"toolbar",items:[{iconCls:"icon-application_form_add",text:"Создать в корне",scope:this,handler:j},{iconCls:"icon-application_form_add",text:"Создать",scope:this,handler:i},{iconCls:"icon-application_form_edit",text:"Изменить",scope:this,disabled:true,itemId:"edit",handler:m},{iconCls:"icon-application_form_delete",text:"Удалить",disabled:true,itemId:"delete",scope:this,handler:k},{iconCls:"icon-table_refresh",text:"Обновить",itemId:"bRefresh",scope:this,handler:n}]}],columns:[{xtype:"treecolumn",text:"№ п/п",width:450,dataIndex:"sequence",sortable:true},{text:"Заголовок",width:160,dataIndex:"caption",sortable:true},{text:"Тип структры",width:60,dataIndex:"parttype_grid",sortable:true},{text:"Название",width:160,dataIndex:"name",sortable:true},{text:"Описание",width:160,dataIndex:"the_comment",sortable:true},{text:"Главный раздел",width:60,dataIndex:"isdocinstance_grid",sortable:true},{text:"Архивировать",width:60,dataIndex:"usearchiving_grid",sortable:true},{text:"Не  журналировать",width:60,dataIndex:"nolog_grid",sortable:true},{text:"Шаблон Бриеф",width:160,dataIndex:"shablonbrief",sortable:true},{text:"Вести журнал",width:60,dataIndex:"usechangelog_grid",sortable:true},{text:"Правило  BRIEF",width:160,dataIndex:"rulebrief",sortable:true}],rbar:f,listeners:{resize:function(u,v,r,t,s,q){f.setWidth(v*0.6)},itemdblclick:function(){m()},itemclick:function(r,q){o.down("#delete").setDisabled(false);o.down("#edit").setDisabled(false);f.instanceid=o.instanceid;f.parentid=q.get("id");f.store.load({params:{parentid:q.get("id")}})},select:function(r,q){o.down("#delete").setDisabled(false);o.down("#edit").setDisabled(false);f.instanceid=o.instanceid;f.parentid=q.get("id");f.store.load({params:{parentid:q.get("id")}})},selectionchange:function(s,r){o.down("#delete").setDisabled(r.length===0);o.down("#edit").setDisabled(r.length===0);var q=r[0];if(q){f.instanceid=o.instanceid;f.parentid=q.get("id");f.store.load({params:{parentid:q.get("id")}})}}}});return o}function DefineForms_bp3doc_store_(){Ext.define("Form_bp3doc_store",{extend:"Ext.form.Panel",alias:"widget.f_bp3doc_store",initComponent:function(){this.addEvents("create");Ext.apply(this,{activeRecord:null,defaultType:"textfield",x:0,fieldDefaults:{labelAlign:"top"},items:[{xtype:"panel",closable:false,title:"",preventHeader:true,id:"bp3doc_store-0",layout:"absolute",border:false,items:[{minWidth:370,width:370,maxWidth:370,x:5,y:0,xtype:"numberfield",value:"0",name:"sequence",itemId:"sequence",fieldLabel:"№ п/п",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:380,y:0,xtype:"textfield",value:"",name:"caption",itemId:"caption",fieldLabel:"Заголовок",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:5,y:46,xtype:"combobox",editable:false,store:enum_PartType,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"parttype_grid",itemId:"parttype_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("parttype",c[0].get("value"))}},fieldLabel:"Тип структры",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:380,y:46,xtype:"textfield",value:"",name:"name",itemId:"name",fieldLabel:"Название",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:140},{minWidth:740,width:740,xtype:"textarea",x:5,y:92,height:80,xtype:"textarea",value:"",name:"the_comment",itemId:"the_comment",fieldLabel:"Описание",allowBlank:true,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:5,y:182,xtype:"combobox",editable:false,store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"isdocinstance_grid",itemId:"isdocinstance_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("isdocinstance",c[0].get("value"))}},fieldLabel:"Главный раздел",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:380,y:182,xtype:"combobox",editable:false,trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue()},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{this.expand()}},store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"usearchiving_grid",itemId:"usearchiving_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("usearchiving",c[0].get("value"))}},fieldLabel:"Архивировать",allowBlank:true,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:5,y:228,xtype:"combobox",editable:false,store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"nolog_grid",itemId:"nolog_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("nolog",c[0].get("value"))}},fieldLabel:"Не  журналировать",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:380,y:228,xtype:"textfield",value:"",name:"shablonbrief",itemId:"shablonbrief",fieldLabel:"Шаблон Бриеф",allowBlank:true,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:5,y:274,xtype:"combobox",editable:false,trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue()},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{this.expand()}},store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"usechangelog_grid",itemId:"usechangelog_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("usechangelog",c[0].get("value"))}},fieldLabel:"Вести журнал",allowBlank:true,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:380,y:274,xtype:"textfield",value:"",name:"rulebrief",itemId:"rulebrief",fieldLabel:"Правило  BRIEF",allowBlank:true,labelWidth:140}],width:770,height:350}],instanceid:"",dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",items:["->",{iconCls:"icon-accept",itemId:"save",text:"Сохранить",disabled:true,scope:this,handler:this.onSave},{iconCls:"icon-cancel",text:"Закрыть",scope:this,handler:this.onReset}]}]});this.callParent()},setActiveRecord:function(c,b,a){this.tree=c;this.activeRecord=b;this.instanceid=a;if(b){this.down("#save").enable();this.getForm().loadRecord(b)}else{this.down("#save").disable();this.getForm().reset()}},onSave:function(){var a=this.activeRecord,b=this.getForm();if(!a){return}if(b.isValid()){b.updateRecord(a);StatusDB("Сохранение данных");Ext.Ajax.request({url:rootURL+"index.php/c_bp3doc_store/setRow",method:"POST",params:{instanceid:this.instanceid,bp3doc_storeid:a.get("bp3doc_storeid"),treeid:a.get("parentrowid"),sequence:a.get("sequence"),caption:a.get("caption"),parttype:a.get("parttype"),name:a.get("name"),the_comment:a.get("the_comment"),isdocinstance:a.get("isdocinstance"),usearchiving:a.get("usearchiving"),nolog:a.get("nolog"),shablonbrief:a.get("shablonbrief"),usechangelog:a.get("usechangelog"),rulebrief:a.get("rulebrief")},success:function(d){var e=d.responseText;var c=Ext.decode(e);if(c.success==false){Ext.MessageBox.show({title:"Ошибка",msg:c.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});StatusErr("Ошибка. "+c.msg)}else{if(a.get("bp3doc_storeid")==""){a.set("id",c.data.bp3doc_storeid);a.set("bp3doc_storeid",c.data.bp3doc_storeid)}StatusReady("Изменения сохранены");b.owner.ownerCt.close()}}})}else{Ext.MessageBox.show({title:"Ошибка",msg:"Не все обязательные поля заполнены!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},onReset:function(){if(this.activeRecord.get("bp3doc_storeid")==""){ts=this.tree.store;ts.getRootNode().removeAll();ts.load()}this.setActiveRecord(null,null,null);this.ownerCt.close()}});Ext.define("EditWindow_bp3doc_store",{extend:"Ext.window.Window",maxHeight:455,maxWidth:900,autoScroll:true,minWidth:750,width:800,minHeight:425,height:425,constrainHeader:true,layout:"absolute",autoShow:true,modal:true,closable:false,closeAction:"destroy",iconCls:"icon-application_form",title:"Раздел",items:[{xtype:"f_bp3doc_store"}]});Ext.define("Form_bp3doc_field",{extend:"Ext.form.Panel",alias:"widget.f_bp3doc_field",initComponent:function(){this.addEvents("create");Ext.apply(this,{activeRecord:null,defaultType:"textfield",x:0,fieldDefaults:{labelAlign:"top"},items:[{xtype:"panel",closable:false,title:"",preventHeader:true,id:"bp3doc_field-0",layout:"absolute",border:false,items:[{minWidth:370,width:370,maxWidth:370,x:5,y:0,xtype:"numberfield",value:"0",name:"sequence",itemId:"sequence",fieldLabel:"№ п/п",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:380,y:0,xtype:"textfield",value:"",name:"name",itemId:"name",fieldLabel:"Имя поля",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:5,y:46,xtype:"textfield",value:"",name:"caption",itemId:"caption",fieldLabel:"Надпись",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:380,y:46,xtype:"textfield",value:"",name:"tabname",itemId:"tabname",fieldLabel:"Имя вкладки",allowBlank:true,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:5,y:92,xtype:"textfield",value:"",name:"fieldgroupbox",itemId:"fieldgroupbox",fieldLabel:"Имя группы",allowBlank:true,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:380,y:92,xtype:"combobox",editable:false,store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"allownull_grid",itemId:"allownull_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("allownull",c[0].get("value"))}},fieldLabel:"Может быть пустым",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:5,y:138,xtype:"combobox",trigger1Cls:"x-form-select-trigger",hideTrigger1:false,onTrigger1Click:function(){if(this.isExpanded){this.collapse()}else{if(this.store.count(false)==0){this.store.load()}this.expand()}},editable:false,listeners:{select:function(a,c,b){a.up("form").activeRecord.set("fieldtype",c[0].get("id"))}},store:cmbstore_bp3ft_def,valueField:"brief",displayField:"brief",typeAhead:true,emptyText:"",name:"fieldtype_grid",itemId:"fieldtype_grid",fieldLabel:"Тип поля",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:380,y:138,xtype:"combobox",editable:false,store:enum_ReferenceType,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"referencetype_grid",itemId:"referencetype_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("referencetype",c[0].get("value"))}},fieldLabel:"Тип ссылки",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:5,y:184,xtype:"numberfield",value:"0",name:"datasize",itemId:"datasize",fieldLabel:"Размер поля",allowBlank:true,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:380,y:184,xtype:"combobox",trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue();this.up("form").activeRecord.set("reftopart",null)},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{if(this.store.count(false)==0){this.store.load()}this.expand()}},editable:false,listeners:{select:function(a,c,b){a.up("form").activeRecord.set("reftopart",c[0].get("id"))}},store:cmbstore_bp3doc_store,valueField:"brief",displayField:"brief",typeAhead:true,emptyText:"",name:"reftopart_grid",itemId:"reftopart_grid",fieldLabel:"Ссылка на раздел",allowBlank:true,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:5,y:230,xtype:"combobox",editable:false,trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue()},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{this.expand()}},store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"internalreference_grid",itemId:"internalreference_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("internalreference",c[0].get("value"))}},fieldLabel:"Ссылка в пределах объекта",allowBlank:true,labelWidth:140},{minWidth:740,width:740,xtype:"textarea",x:5,y:276,height:80,xtype:"textarea",value:"",name:"thecomment",itemId:"thecomment",fieldLabel:"Описание",allowBlank:true,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:5,y:366,xtype:"combobox",editable:false,trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue()},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{this.expand()}},store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"isautonumber_grid",itemId:"isautonumber_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("isautonumber",c[0].get("value"))}},fieldLabel:"Автонумерация",allowBlank:true,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:380,y:366,xtype:"combobox",editable:false,store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"isbrief_grid",itemId:"isbrief_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("isbrief",c[0].get("value"))}},fieldLabel:"Краткая информация",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:5,y:412,xtype:"combobox",editable:false,trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue()},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{this.expand()}},store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"istabbrief_grid",itemId:"istabbrief_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("istabbrief",c[0].get("value"))}},fieldLabel:"Для отображения в таблице",allowBlank:true,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:380,y:412,xtype:"textfield",value:"",name:"thestyle",itemId:"thestyle",fieldLabel:"Стиль",allowBlank:true,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:5,y:458,xtype:"textfield",value:"",name:"themask",itemId:"themask",fieldLabel:"Маска",allowBlank:true,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:380,y:458,xtype:"textfield",value:"",name:"shablonbrief",itemId:"shablonbrief",fieldLabel:"Шаблон для краткого отображения",allowBlank:true,labelWidth:140}],width:770,height:534}],instanceid:"",dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",items:["->",{iconCls:"icon-accept",itemId:"save",text:"Сохранить",disabled:true,scope:this,handler:this.onSave},{iconCls:"icon-cancel",text:"Закрыть",scope:this,handler:this.onReset}]}]});this.callParent()},setActiveRecord:function(c,a,b){this.activeRecord=c;this.instanceid=a;this.parentid=b;if(c){this.down("#save").enable();this.getForm().loadRecord(c)}else{this.down("#save").disable();this.getForm().reset()}},onSave:function(){var a=this.activeRecord,b=this.getForm();if(!a){return}if(b.isValid()){b.updateRecord(a);StatusDB("Сохранение данных");Ext.Ajax.request({url:rootURL+"index.php/c_bp3doc_field/setRow",method:"POST",params:{instanceid:this.instanceid,parentid:this.parentid,bp3doc_fieldid:a.get("bp3doc_fieldid"),sequence:a.get("sequence"),name:a.get("name"),caption:a.get("caption"),tabname:a.get("tabname"),fieldgroupbox:a.get("fieldgroupbox"),allownull:a.get("allownull"),fieldtype:a.get("fieldtype"),referencetype:a.get("referencetype"),datasize:a.get("datasize"),reftopart:a.get("reftopart"),internalreference:a.get("internalreference"),thecomment:a.get("thecomment"),isautonumber:a.get("isautonumber"),isbrief:a.get("isbrief"),istabbrief:a.get("istabbrief"),thestyle:a.get("thestyle"),themask:a.get("themask"),shablonbrief:a.get("shablonbrief")},success:function(d){var e=d.responseText;var c=Ext.decode(e);if(c.success==false){Ext.MessageBox.show({title:"Ошибка",msg:c.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});StatusErr("Ошибка. "+c.msg)}else{if(a.get("bp3doc_fieldid")==""){a.set("bp3doc_fieldid",c.data.bp3doc_fieldid)}StatusReady("Изменения сохранены");b.owner.ownerCt.close()}}})}else{Ext.MessageBox.show({title:"Ошибка",msg:"Не все обязательные поля заполнены!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},onReset:function(){if(this.activeRecord.get("bp3doc_fieldid")==""){this.activeRecord.store.reload()}this.setActiveRecord(null,null);this.ownerCt.close()}});Ext.define("EditWindow_bp3doc_field",{extend:"Ext.window.Window",maxHeight:639,maxWidth:900,autoScroll:true,minWidth:750,width:800,minHeight:609,height:609,constrainHeader:true,layout:"absolute",autoShow:true,modal:true,closable:false,closeAction:"destroy",iconCls:"icon-application_form",title:"Поле",items:[{xtype:"f_bp3doc_field"}]})};
Ext.require(["Ext.form.*"]);function DefineInterface_bp3doc_def_(a,b,j){var g;var h=false;var i=false;function d(m,l){var k=g.activeRecord,n=g.getForm();if(!k){return}if(n.isValid()){n.updateRecord(k);StatusDB("Сохранение данных");Ext.Ajax.request({url:rootURL+"index.php/c_bp3doc_def/setRow",method:"POST",params:{instanceid:g.instanceid,bp3doc_defid:k.get("bp3doc_defid"),thecaption:k.get("thecaption"),name:k.get("name"),issingleinstance:k.get("issingleinstance"),thecomment:k.get("thecomment"),useownership:k.get("useownership"),usearchiving:k.get("usearchiving"),commitfullobject:k.get("commitfullobject")},success:function(p){var q=p.responseText;var o=Ext.decode(q);if(o.success==false){Ext.MessageBox.show({title:"Ошибка",msg:o.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});StatusErr("Ошибка. "+o.msg);h=false}else{if(k.get("bp3doc_defid")==""){k.set("bp3doc_defid",o.data.bp3doc_defid)}StatusReady("Изменения сохранены");h=true;if(j){Ext.Ajax.request({url:rootURL+'index.php/c_v_autobp3doc_def/getRows?&filter=[{"property":"bp3doc_defid","value":"'+k.get("bp3doc_defid")+'"}]',method:"GET",success:function(s){var r=Ext.decode(s.responseText);j.set(r.rows[0]);j.commit()}})}if(m){if(typeof(l)=="function"){l()}g.up("window").close()}}}})}else{Ext.MessageBox.show({title:"Ошибка",msg:"Не все обязательные поля заполнены!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}function e(k){d(false,k)}function f(k){d(true,k)}function c(){g.setActiveRecord(null,null)}g=new Ext.form.Panel({itemId:a+"",autoScroll:true,border:0,bodyPadding:5,activeRecord:null,selection:j,defaultType:"textfield",doSave:f,canClose:function(){if(i){if(!g.getForm().isValid()){return true}return true}else{if(!g.getForm().isValid()){return false}if(h){return true}return false}},fieldDefaults:{labelAlign:"right",labelWidth:110},items:[{xtype:"fieldset",anchor:"100%",id:"bp3doc_def-0",x:0,border:1,layout:"absolute",items:[{minWidth:365,width:365,maxWidth:365,x:5,y:5,labelWidth:140,xtype:"textfield",value:"",name:"thecaption",itemId:"thecaption",fieldLabel:"Название",labelClsExtra:"x-item-mandatory",allowBlank:false},{minWidth:365,width:365,maxWidth:365,x:375,y:5,labelWidth:140,xtype:"textfield",value:"",name:"name",itemId:"name",fieldLabel:"Код",labelClsExtra:"x-item-mandatory",allowBlank:false},{minWidth:365,width:365,maxWidth:365,x:5,y:35,labelWidth:140,xtype:"combobox",editable:false,store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"issingleinstance_grid",itemId:"issingleinstance_grid",listeners:{select:function(k,m,l){k.up("form").activeRecord.set("issingleinstance",m[0].get("value"))}},fieldLabel:"Допускается только один объект",labelClsExtra:"x-item-mandatory",allowBlank:false},{minWidth:720,xtype:"textarea",x:5,y:65,height:80,labelWidth:140,xtype:"textarea",value:"",name:"thecomment",itemId:"thecomment",fieldLabel:"Описание",allowBlank:true},{minWidth:365,width:365,maxWidth:365,x:5,y:155,labelWidth:140,xtype:"combobox",editable:false,trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue()},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{this.expand()}},store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"useownership_grid",itemId:"useownership_grid",listeners:{select:function(k,m,l){k.up("form").activeRecord.set("useownership",m[0].get("value"))}},fieldLabel:"Видмость зависит от пользователя",allowBlank:true},{minWidth:365,width:365,maxWidth:365,x:375,y:155,labelWidth:140,xtype:"combobox",editable:false,trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue()},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{this.expand()}},store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"usearchiving_grid",itemId:"usearchiving_grid",listeners:{select:function(k,m,l){k.up("form").activeRecord.set("usearchiving",m[0].get("value"))}},fieldLabel:"Архивировать вместо удаления",allowBlank:true},{minWidth:365,width:365,maxWidth:365,x:5,y:185,labelWidth:140,xtype:"combobox",editable:false,trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue()},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{this.expand()}},store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"commitfullobject_grid",itemId:"commitfullobject_grid",listeners:{select:function(k,m,l){k.up("form").activeRecord.set("commitfullobject",m[0].get("value"))}},fieldLabel:"Сохранять объект целиком",allowBlank:true}],height:235}],instanceid:"",setActiveRecord:function(l,k){g.activeRecord=l;g.instanceid=k;if(l){g.getForm().loadRecord(l);i=g.getForm().isValid()}else{g.getForm().reset()}}});return g}function DefineForms_bp3doc_def_(){Ext.define("Form_bp3doc_def",{extend:"Ext.form.Panel",alias:"widget.f_bp3doc_def",initComponent:function(){this.addEvents("create");Ext.apply(this,{activeRecord:null,defaultType:"textfield",x:0,fieldDefaults:{labelAlign:"top"},items:[{xtype:"panel",closable:false,title:"",preventHeader:true,id:"bp3doc_def-0",layout:"absolute",border:false,items:[{minWidth:370,width:370,maxWidth:370,x:5,y:0,xtype:"textfield",value:"",name:"thecaption",itemId:"thecaption",fieldLabel:"Название",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:380,y:0,xtype:"textfield",value:"",name:"name",itemId:"name",fieldLabel:"Код",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:5,y:46,xtype:"combobox",editable:false,store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"issingleinstance_grid",itemId:"issingleinstance_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("issingleinstance",c[0].get("value"))}},fieldLabel:"Допускается только один объект",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:140},{minWidth:740,width:740,xtype:"textarea",x:5,y:92,height:80,xtype:"textarea",value:"",name:"thecomment",itemId:"thecomment",fieldLabel:"Описание",allowBlank:true,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:5,y:182,xtype:"combobox",editable:false,trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue()},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{this.expand()}},store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"useownership_grid",itemId:"useownership_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("useownership",c[0].get("value"))}},fieldLabel:"Видмость зависит от пользователя",allowBlank:true,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:380,y:182,xtype:"combobox",editable:false,trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue()},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{this.expand()}},store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"usearchiving_grid",itemId:"usearchiving_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("usearchiving",c[0].get("value"))}},fieldLabel:"Архивировать вместо удаления",allowBlank:true,labelWidth:140},{minWidth:370,width:370,maxWidth:370,x:5,y:228,xtype:"combobox",editable:false,trigger1Cls:"x-form-clear-trigger",trigger2Cls:"x-form-select-trigger",hideTrigger1:false,hideTrigger2:false,onTrigger1Click:function(){this.collapse();this.clearValue()},onTrigger2Click:function(){if(this.isExpanded){this.collapse()}else{this.expand()}},store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"commitfullobject_grid",itemId:"commitfullobject_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("commitfullobject",c[0].get("value"))}},fieldLabel:"Сохранять объект целиком",allowBlank:true,labelWidth:140}],width:770,height:304}],instanceid:"",dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",items:["->",{iconCls:"icon-accept",itemId:"save",text:"Сохранить",disabled:true,scope:this,handler:this.onSave}]}]});this.callParent()},setActiveRecord:function(b,a){this.activeRecord=b;this.instanceid=a;if(b){this.down("#save").enable();this.getForm().loadRecord(b)}else{this.down("#save").disable();this.getForm().reset()}},onSave:function(){var a=this.activeRecord,b=this.getForm();if(!a){return}if(b.isValid()){b.updateRecord(a);StatusDB("Сохранение данных");Ext.Ajax.request({url:rootURL+"index.php/c_bp3doc_def/setRow",method:"POST",params:{instanceid:this.instanceid,bp3doc_defid:a.get("bp3doc_defid"),thecaption:a.get("thecaption"),name:a.get("name"),issingleinstance:a.get("issingleinstance"),thecomment:a.get("thecomment"),useownership:a.get("useownership"),usearchiving:a.get("usearchiving"),commitfullobject:a.get("commitfullobject")},success:function(d){var e=d.responseText;var c=Ext.decode(e);if(c.success==false){Ext.MessageBox.show({title:"Ошибка",msg:c.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});StatusErr("Ошибка. "+c.msg)}else{if(a.get("bp3doc_defid")==""){a.set("bp3doc_defid",c.data.bp3doc_defid)}StatusReady("Изменения сохранены")}}})}else{Ext.MessageBox.show({title:"Ошибка",msg:"Не все обязательные поля заполнены!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},onReset:function(){if(this.activeRecord.get("bp3doc_defid")==""){this.activeRecord.store.reload()}this.setActiveRecord(null,null);this.ownerCt.close()}});Ext.define("EditWindow_bp3doc_def",{extend:"Ext.window.Window",maxHeight:409,maxWidth:900,autoScroll:true,minWidth:750,width:800,minHeight:379,height:379,constrainHeader:true,layout:"absolute",autoShow:true,modal:true,closable:false,closeAction:"destroy",iconCls:"icon-application_form",title:"Описание",items:[{xtype:"f_bp3doc_def"}]})};
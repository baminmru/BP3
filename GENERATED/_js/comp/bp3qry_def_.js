Ext.require(["Ext.form.*"]);function DefineInterface_bp3qry_def_(a,b,j){var g;var h=false;var i=false;function d(m,l){var k=g.activeRecord,n=g.getForm();if(!k){return}if(n.isValid()){n.updateRecord(k);StatusDB("Сохранение данных");Ext.Ajax.request({url:rootURL+"index.php/c_bp3qry_def/setRow",method:"POST",params:{instanceid:g.instanceid,bp3qry_defid:k.get("bp3qry_defid"),srcpart:k.get("srcpart"),the_alias:k.get("the_alias"),forchoose:k.get("forchoose"),name:k.get("name")},success:function(p){var q=p.responseText;var o=Ext.decode(q);if(o.success==false){Ext.MessageBox.show({title:"Ошибка",msg:o.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});StatusErr("Ошибка. "+o.msg);h=false}else{if(k.get("bp3qry_defid")==""){k.set("bp3qry_defid",o.data.bp3qry_defid)}StatusReady("Изменения сохранены");h=true;if(j){Ext.Ajax.request({url:rootURL+'index.php/c_v_autobp3qry_def/getRows?&filter=[{"property":"bp3qry_defid","value":"'+k.get("bp3qry_defid")+'"}]',method:"GET",success:function(s){var r=Ext.decode(s.responseText);j.set(r.rows[0]);j.commit()}})}if(m){if(typeof(l)=="function"){l()}g.up("window").close()}}}})}else{Ext.MessageBox.show({title:"Ошибка",msg:"Не все обязательные поля заполнены!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}function e(k){d(false,k)}function f(k){d(true,k)}function c(){g.setActiveRecord(null,null)}g=new Ext.form.Panel({itemId:a+"",autoScroll:true,border:0,bodyPadding:5,activeRecord:null,selection:j,defaultType:"textfield",doSave:f,canClose:function(){if(i){if(!g.getForm().isValid()){return true}return true}else{if(!g.getForm().isValid()){return false}if(h){return true}return false}},fieldDefaults:{labelAlign:"right",labelWidth:110},items:[{xtype:"fieldset",anchor:"100%",id:"bp3qry_def-0",x:0,border:1,layout:"absolute",items:[{minWidth:365,width:365,maxWidth:365,x:5,y:5,labelWidth:140,xtype:"combobox",trigger1Cls:"x-form-select-trigger",hideTrigger1:false,onTrigger1Click:function(){if(this.isExpanded){this.collapse()}else{if(this.store.count(false)==0){this.store.load()}this.expand()}},editable:false,listeners:{select:function(k,m,l){k.up("form").activeRecord.set("srcpart",m[0].get("id"))}},store:cmbstore_bp3doc_store,valueField:"brief",displayField:"brief",typeAhead:true,emptyText:"",name:"srcpart_grid",itemId:"srcpart_grid",fieldLabel:"Представление дя раздела",labelClsExtra:"x-item-mandatory",allowBlank:false},{minWidth:365,width:365,maxWidth:365,x:375,y:5,labelWidth:140,xtype:"textfield",value:"",name:"the_alias",itemId:"the_alias",fieldLabel:"Псевдоним",labelClsExtra:"x-item-mandatory",allowBlank:false},{minWidth:365,width:365,maxWidth:365,x:5,y:35,labelWidth:140,xtype:"combobox",editable:false,store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"forchoose_grid",itemId:"forchoose_grid",listeners:{select:function(k,m,l){k.up("form").activeRecord.set("forchoose",m[0].get("value"))}},fieldLabel:"Для поиска",labelClsExtra:"x-item-mandatory",allowBlank:false},{minWidth:365,width:365,maxWidth:365,x:375,y:35,labelWidth:140,xtype:"textfield",value:"",name:"name",itemId:"name",fieldLabel:"Название",labelClsExtra:"x-item-mandatory",allowBlank:false}],height:85}],instanceid:"",setActiveRecord:function(l,k){g.activeRecord=l;g.instanceid=k;if(l){g.getForm().loadRecord(l);i=g.getForm().isValid()}else{g.getForm().reset()}}});return g}function DefineForms_bp3qry_def_(){Ext.define("Form_bp3qry_def",{extend:"Ext.form.Panel",alias:"widget.f_bp3qry_def",initComponent:function(){this.addEvents("create");Ext.apply(this,{activeRecord:null,defaultType:"textfield",x:0,fieldDefaults:{labelAlign:"top"},items:[{xtype:"panel",closable:false,title:"",preventHeader:true,id:"bp3qry_def-0",layout:"absolute",border:false,items:[{minWidth:220,width:220,maxWidth:220,x:5,y:0,xtype:"combobox",trigger1Cls:"x-form-select-trigger",hideTrigger1:false,onTrigger1Click:function(){if(this.isExpanded){this.collapse()}else{if(this.store.count(false)==0){this.store.load()}this.expand()}},editable:false,listeners:{select:function(a,c,b){a.up("form").activeRecord.set("srcpart",c[0].get("id"))}},store:cmbstore_bp3doc_store,valueField:"brief",displayField:"brief",typeAhead:true,emptyText:"",name:"srcpart_grid",itemId:"srcpart_grid",fieldLabel:"Представление дя раздела",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120},{minWidth:220,width:220,maxWidth:220,x:255,y:0,xtype:"textfield",value:"",name:"the_alias",itemId:"the_alias",fieldLabel:"Псевдоним",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120},{minWidth:220,width:220,maxWidth:220,x:505,y:0,xtype:"combobox",editable:false,store:enum_Boolean,valueField:"name",displayField:"name",typeAhead:true,queryMode:"local",emptyText:"",name:"forchoose_grid",itemId:"forchoose_grid",listeners:{select:function(a,c,b){a.up("form").activeRecord.set("forchoose",c[0].get("value"))}},fieldLabel:"Для поиска",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120},{minWidth:220,width:220,maxWidth:220,x:5,y:46,xtype:"textfield",value:"",name:"name",itemId:"name",fieldLabel:"Название",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120}],width:770,height:122}],instanceid:"",dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",items:["->",{iconCls:"icon-accept",itemId:"save",text:"Сохранить",disabled:true,scope:this,handler:this.onSave}]}]});this.callParent()},setActiveRecord:function(b,a){this.activeRecord=b;this.instanceid=a;if(b){this.down("#save").enable();this.getForm().loadRecord(b)}else{this.down("#save").disable();this.getForm().reset()}},onSave:function(){var a=this.activeRecord,b=this.getForm();if(!a){return}if(b.isValid()){b.updateRecord(a);StatusDB("Сохранение данных");Ext.Ajax.request({url:rootURL+"index.php/c_bp3qry_def/setRow",method:"POST",params:{instanceid:this.instanceid,bp3qry_defid:a.get("bp3qry_defid"),srcpart:a.get("srcpart"),the_alias:a.get("the_alias"),forchoose:a.get("forchoose"),name:a.get("name")},success:function(d){var e=d.responseText;var c=Ext.decode(e);if(c.success==false){Ext.MessageBox.show({title:"Ошибка",msg:c.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});StatusErr("Ошибка. "+c.msg)}else{if(a.get("bp3qry_defid")==""){a.set("bp3qry_defid",c.data.bp3qry_defid)}StatusReady("Изменения сохранены")}}})}else{Ext.MessageBox.show({title:"Ошибка",msg:"Не все обязательные поля заполнены!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},onReset:function(){if(this.activeRecord.get("bp3qry_defid")==""){this.activeRecord.store.reload()}this.setActiveRecord(null,null);this.ownerCt.close()}});Ext.define("EditWindow_bp3qry_def",{extend:"Ext.window.Window",maxHeight:227,maxWidth:900,autoScroll:true,minWidth:750,width:800,minHeight:197,height:197,constrainHeader:true,layout:"absolute",autoShow:true,modal:true,closable:false,closeAction:"destroy",iconCls:"icon-application_form",title:"Представление",items:[{xtype:"f_bp3qry_def"}]})};
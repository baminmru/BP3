Ext.require(["Ext.form.*"]);function DefineInterface_bp3app_info_(a,b,j){var g;var h=false;var i=false;function d(m,l){var k=g.activeRecord,n=g.getForm();if(!k){return}if(n.isValid()){n.updateRecord(k);StatusDB("Сохранение данных");Ext.Ajax.request({url:rootURL+"index.php/c_bp3app_info/setRow",method:"POST",params:{instanceid:g.instanceid,bp3app_infoid:k.get("bp3app_infoid"),name:k.get("name"),version:k.get("version")},success:function(p){var q=p.responseText;var o=Ext.decode(q);if(o.success==false){Ext.MessageBox.show({title:"Ошибка",msg:o.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});StatusErr("Ошибка. "+o.msg);h=false}else{if(k.get("bp3app_infoid")==""){k.set("bp3app_infoid",o.data.bp3app_infoid)}StatusReady("Изменения сохранены");h=true;if(j){Ext.Ajax.request({url:rootURL+'index.php/c_v_autobp3app_info/getRows?&filter=[{"property":"bp3app_infoid","value":"'+k.get("bp3app_infoid")+'"}]',method:"GET",success:function(s){var r=Ext.decode(s.responseText);j.set(r.rows[0]);j.commit()}})}if(m){if(typeof(l)=="function"){l()}g.up("window").close()}}}})}else{Ext.MessageBox.show({title:"Ошибка",msg:"Не все обязательные поля заполнены!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}}function e(k){d(false,k)}function f(k){d(true,k)}function c(){g.setActiveRecord(null,null)}g=new Ext.form.Panel({itemId:a+"",autoScroll:true,border:0,bodyPadding:5,activeRecord:null,selection:j,defaultType:"textfield",doSave:f,canClose:function(){if(i){if(!g.getForm().isValid()){return true}return true}else{if(!g.getForm().isValid()){return false}if(h){return true}return false}},fieldDefaults:{labelAlign:"right",labelWidth:110},items:[{xtype:"fieldset",anchor:"100%",id:"bp3app_info-0",x:0,border:1,layout:"absolute",items:[{minWidth:720,x:5,y:5,labelWidth:140,xtype:"textfield",value:"",name:"name",itemId:"name",fieldLabel:"Название",labelClsExtra:"x-item-mandatory",allowBlank:false},{minWidth:365,width:365,maxWidth:365,x:5,y:35,labelWidth:140,xtype:"numberfield",value:"0",name:"version",itemId:"version",fieldLabel:"Версия",labelClsExtra:"x-item-mandatory",allowBlank:false}],height:85}],instanceid:"",setActiveRecord:function(l,k){g.activeRecord=l;g.instanceid=k;if(l){g.getForm().loadRecord(l);i=g.getForm().isValid()}else{g.getForm().reset()}}});return g}function DefineForms_bp3app_info_(){Ext.define("Form_bp3app_info",{extend:"Ext.form.Panel",alias:"widget.f_bp3app_info",initComponent:function(){this.addEvents("create");Ext.apply(this,{activeRecord:null,defaultType:"textfield",x:0,fieldDefaults:{labelAlign:"top"},items:[{xtype:"panel",closable:false,title:"",preventHeader:true,id:"bp3app_info-0",layout:"absolute",border:false,items:[{minWidth:740,x:5,y:0,xtype:"textfield",value:"",name:"name",itemId:"name",fieldLabel:"Название",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120},{minWidth:220,width:220,maxWidth:220,x:5,y:46,xtype:"numberfield",value:"0",name:"version",itemId:"version",fieldLabel:"Версия",labelClsExtra:"x-item-mandatory",allowBlank:false,labelWidth:120}],width:770,height:122}],instanceid:"",dockedItems:[{xtype:"toolbar",dock:"bottom",ui:"footer",items:["->",{iconCls:"icon-accept",itemId:"save",text:"Сохранить",disabled:true,scope:this,handler:this.onSave}]}]});this.callParent()},setActiveRecord:function(b,a){this.activeRecord=b;this.instanceid=a;if(b){this.down("#save").enable();this.getForm().loadRecord(b)}else{this.down("#save").disable();this.getForm().reset()}},onSave:function(){var a=this.activeRecord,b=this.getForm();if(!a){return}if(b.isValid()){b.updateRecord(a);StatusDB("Сохранение данных");Ext.Ajax.request({url:rootURL+"index.php/c_bp3app_info/setRow",method:"POST",params:{instanceid:this.instanceid,bp3app_infoid:a.get("bp3app_infoid"),name:a.get("name"),version:a.get("version")},success:function(d){var e=d.responseText;var c=Ext.decode(e);if(c.success==false){Ext.MessageBox.show({title:"Ошибка",msg:c.msg,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});StatusErr("Ошибка. "+c.msg)}else{if(a.get("bp3app_infoid")==""){a.set("bp3app_infoid",c.data.bp3app_infoid)}StatusReady("Изменения сохранены")}}})}else{Ext.MessageBox.show({title:"Ошибка",msg:"Не все обязательные поля заполнены!",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}},onReset:function(){if(this.activeRecord.get("bp3app_infoid")==""){this.activeRecord.store.reload()}this.setActiveRecord(null,null);this.ownerCt.close()}});Ext.define("EditWindow_bp3app_info",{extend:"Ext.window.Window",maxHeight:227,maxWidth:900,autoScroll:true,minWidth:750,width:800,minHeight:197,height:197,constrainHeader:true,layout:"absolute",autoShow:true,modal:true,closable:false,closeAction:"destroy",iconCls:"icon-application_form",title:"Описание",items:[{xtype:"f_bp3app_info"}]})};